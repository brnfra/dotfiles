#!/usr/bin/env bash
# Arquivo: connection
# Autor: Bruno Franco
# Ultima_modificacao: 20-03-2023
# Download: git@github.com:brnfra
# Licence:Este arquivo é de domínio público
# Garantia: O autor não se responsabiliza por eventuais danos
#           causados pelo uso deste script.
# https://askubuntu.com/questions/522505/script-to-monitor-internet-connection-stability
#site list
# shellcheck source=~/bin/dotfiles_env
. dotfiles_env

site_list='google.com' 
site_list+=' github.com' 
site_list+=' www.amazon.com.br'
site_list+=' deb.debian.org'
#site_list+=' www.debian.org/security'
# by Adam Katz (stackoverflow)
for Site in $site_list; do
    if nc -z -w 1 $Site 443 && echo |openssl s_client -connect "$Site":443 2>&1 |awk '
	$1 == "SSL" && $2 == "handshake" { handshake = 1 }
	handshake && $1 == "Verification:" { ok = $2; exit }
	END { exit ok != "OK" }'
    then
	cmOk "$Site" "Reached"
    else
	clnError "Can't reach: $Site"
    fi
done
