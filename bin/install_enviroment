#!/usr/bin/env bash

#Requirements: Git and Ssh

#Personal data here(comment and CHANGE E-MAIL & NAME) 
email="devlabbr@gmail.com"
full_name="brnfra"

folder_list="$HOME/.local/opt" 
folder_list+=" $HOME/.local/share/fonts" 
folder_list+=" $HOME/.wallpapers" 
folder_list+=" $HOME/.ssh" 
folder_list+=" $HOME/Documents/Projects/git" 
folder_list+=" $HOME/.vim/backups" 
folder_list+=" $HOME/.vim/backups/swaps" 
folder_list+=" $HOME/.vim/backups/undo" 
folder_list+=" $HOME/.vim/bundle" 
folder_list+=" $HOME/.vim/autoload" 
folder_list+=" $HOME/.config-bkp/copiados" 
folder_list+=" $HOME/.config-bkp/excluidos"

# create ~/.local dirs
printf "[INFO] Creating folders\r\n"
sleep 1

for Folder in $folder_list
do
	if [ -d "$Folder" ] 
	then
		printf "[INFO] Creating folders: %s already exists.\n" "$Folder"
	else
		mkdir -p "$Folder"
		printf "[INFO] Creating folders: %s created.\n" "$Folder"
	fi
done

printf "[INFO] Creating folders: Done\n"
sleep 1

PROCESS_ID=$!
wait $PROCESS_ID

#setup git(script from https://github.com/lewagon/dotfiles/git_setup.sh )
if command -v git &> /dev/null
then
    printf "[INFO] Add git config.\r"
    sleep 1
    git config --global user.email "$email"
    git config --global user.name "$full_name"
    printf "[INFO] Add git config: Done.\r\n"
    sleep 1
	
else
    echo "[ERROR] Add git config: Git installation needed. Run apt-get install git or read output for problems"
    exit 1
fi

#setup ssh
#by  nishanthshanmugham and lhunath  #in https://stackoverflow.com/questions/592620/how-can-i-check-if-a-program-exists-from-a-bash-script
if command -v ssh &> /dev/null
then
    printf "[INFO] Creating pub keys.\r" 
	sleep 1
    
	if [ -f "$HOME/.ssh/id_ed25519" ] 
	then
		printf "[INFO] Creating pub keys: ssh-agent in use.\r"
		sleep 1
	else
		eval ssh-keygen -t ed25519 -C "$email";  wait $!
		eval "$(ssh-agent -s)" ssh-add
		"$HOME/.ssh/id_ed25519"
	fi
	printf "[INFO] Creating pub keys: Done\r\n"
	sleep 1
else
    echo "[ERROR] Creating pub keys: SSH installation needed. Install ssh or read output for problems"
    exit 2
fi
printf "[INFO] Enviroment installed\n"
