#!/usr/bin/env bash
# shellcheck source=~/bin/dotfiles_env
. dotfiles_env

make_dirs() {
    folder_list="$HOME/.local/opt"
    folder_list+=" $HOME/.local/share/fonts"
    folder_list+=" $HOME/.wallpapers"
    folder_list+=" $HOME/.ssh"
    folder_list+=" $HOME/.cache"
    folder_list+=" $HOME/Documents/Projects/git"
    folder_list+=" $HOME/.vim/backups"
    folder_list+=" $HOME/.vim/backups/swaps"
    folder_list+=" $HOME/.vim/backups/undo"
    folder_list+=" $HOME/.vim/bundle"
    folder_list+=" $HOME/.vim/autoload"
    folder_list+=" $HOME/.config-bkp"
    clnInfo "Creating folders"
    for Folder in $folder_list
    do
	if [ -d "$Folder" ]
	then
	    cInfo
	    clnItalic "$Folder" "Already exists."
	else
	    mkdir -p "$Folder"
	    cInfo
	    clnItalic "$Folder" "Folders created."
	fi
    done
    cmOk "Creating folders: "
}
config_git() {
    #setup git(script from https://github.com/lewagon/dotfiles/git_setup.sh )
    if command -v git &> /dev/null
    then
	git config --global user.email "$1"
	git config --global user.name "$2"
	cmOk "Add git config_git"
    else
	clnError "Add git config: Git installation needed. Run apt-get install git or read output for problems"
	exit 1
    fi
}
config_ssh() {
    #setup ssh
    #by  nishanthshanmugham and lhunath
    #in https://stackoverflow.com/questions/592620/how-can-i-check-if-a-program-exists-from-a-bash-script
    if command -v ssh &> /dev/null
    then

	if [ -f "$HOME/.ssh/id_ed25519" ]
	then
	    clnInfo "Creating pub keys: ssh-agent in use."
	else
	    eval ssh-keygen -t ed25519 -C "$1";  wait $!
	    eval "$(ssh-agent -s)" ssh-add "$HOME/.ssh/id_ed25519"
	fi
	cInfo "Create pub keys: "
	cOk
    else
	clnError "Creating pub keys: SSH installation needed. Install ssh or read output for problems"
	exit 2
    fi
}
make_dirs
config_git "$1" "$2"
config_ssh "$1"
clnInfo "Enviroment installed"
