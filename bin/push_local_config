#!/usr/bin/env bash
#  Arquivo: push_local_config
#  Autor: Bruno Franco
#  Ultima_modificacao: 02-03-2023
#  Download: git@github.com:brnfra
#  Licence:Este arquivo é de domínio público
#  Garantia: O autor não se responsabiliza por eventuais danos
#            causados pelo uso deste arquivo.
local=$(pwd)
pushFrom="$HOME/Documents/Projects/git/dotfiles"
branch="main"
checkHome="$HOME/dotfilesTest.sh"
test=$("$checkHome" | awk '/OK/ || /FAILED/''{print $1}')

function git_push () {
    upfiles=$(git status -sb | sed '1d;s/^\sM/ Mod\-/g;s/??/ Add\-/g;s/^\sD/ Del\-/g')
    message="$@. $upfiles"
    git add -A -v;git commit -v -m "$message";git push origin $branch   
    if [ $? ];then
	printf "[INFO] Accomplished, no errors.\n" 
	git status -sb
    else
	git status -sb 
	printf "[ERROR] A error occours. Check log.\n" 
    fi
}

if [ "$test" = "FAILED" ];then
    "$checkHome" | awk '/FAIL/''{print}'
    cd "$local" || return
    exit 1
else
    printf "[INFO] Files and folders check: OK\n" 
    if [ -d "$pushFrom" ];then
	cd "$pushFrom" || return
	stage_local_config
	git_push "$1"
    else
	printf "[ERROR] No %s found.\n" "$pushFrom" 
	exit 1
    fi

    cd "$local" || return
    exit 0
fi


cd "$local" || return
