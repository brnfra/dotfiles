#!/usr/bin/env bash

# Arquivo: arquivar
# Autor: Bruno Franco
# Ultima_modificacao: 29-12-2022
# Download: git@github.com:brnfra
# Licence:Este arquivo é de domínio público
# Garantia: O autor não se responsabiliza por eventuais danos
#           causados pelo uso deste script.

#   Tem o proposito de organizar os arquivos que tem nome padrão começando com
#   o template AAAAmmdd, sendo AAAA para digito do ano, mm para digitos do mes, 
#   dd para digito do dia

#   cria pasta no padrão ./AAAA/mm e insere os arquivos dentro
#   não se aplica a pastas ou nomes diferentes do padrão

files=$(find . -maxdepth 1 -type f -name '[0-9]*' | sed 's|\.\/||gi')

year=$(find . -maxdepth 1 -type f -name '[0-9]*' | sed -r 's/(.{5}.).*/\1/gi; s|\.\/||gi' | sort -u )

month=$(find . -maxdepth 1 -type f -name '[0-9]*' | sed -r 's/(.{7}.).*/\1/gi; s|\.\/||gi; s/.*(.{2})/\1/gi' | sort -u)

#create and move to folders
for File in $files
do
    yearAux=$(echo "$File" | sed -r 's/(.{3}.).*/\1/gi')
    monthAux=$(echo "$File" | sed -r 's/(.{5}.).*/\1/gi; s/.*(.{2})/\1/gi')

    mkdir -p ./"$yearAux/$monthAux"
    mv "$File" --target-directory=./"$yearAux/$monthAux"

done

#delete empty folders crated
for Year in $year 
do
   # mkdir -p -v ./"$Year"
    for Month in $month
    do
	find ./"$Year/$Month" -maxdepth 1 -type d -empty -delete
    done
done
