#!/usr/bin/env bash
# Arquivo: makeFolderByType
# Autor: Bruno Franco
# Ultima_modificacao: 03-03-2023
# Download: git@github.com:brnfra
# Licence:Este arquivo é de domínio público
# Garantia: O autor não se responsabiliza por eventuais danos
#           causados pelo uso deste script.
#   Tem o proposito de organizar os arquivos que tem nome padrão começando com
#   o template AAAAmmdd, sendo AAAA para digito do ano, mm para digitos do mes, 
#   dd para digito do dia
#   cria pasta no padrão ./AAAA/mm e insere os arquivos 
#   não se aplica a pastas ou nomes diferentes do padrão
filesByExt=$(find . -maxdepth 1 -type f -name '*.*' | sed 's|\.\/||gi')
today_year=$(date +%Y)
today_year=$((today_year + 1))
saveIn=${1:-'.'}
# Color {{{ 
function cInfo {
    local reset
    local bold
    local cyan
    reset=$(tput sgr0);
    bold=$(tput bold);
    cyan=$(tput setaf 39);
    printf "%s%s[INFO] %s %s" "$cyan" "$bold" "$reset" "$1" 
}
function cError {
    local reset
    local bold
    local red
    reset=$(tput sgr0);
    bold=$(tput bold);
    red=$(tput setaf 124);
    printf "%s%s[ERROR] %s %s" "$red" "$bold" "$reset" "$1" 
}
function cOk {
    local reset
    local bold
    local green
    reset=$(tput sgr0);
    bold=$(tput bold);
    green=$(tput setaf 34);
    printf "%s%s OK \n%s" "$green" "$bold" "$reset" 
}
function cItalic {
    local cyan
    local italic
    local reset
    cyan=$(tput setaf 39);
    italic=$(tput sitm);
    reset=$(tput sgr0);
    printf "%s%s %s %s %s" "$cyan" "$italic" "$1" "$reset" "$2"
}
# }}}

#create and move to folders
foldering_by_type() {
    local Dir="$1"

    for File in $filesByExt
    do
	echo "${File##*'.'}" | sed 's/sh//gi' >> ext_list
    done
    ext_list=$(sort -u < ext_list)
    if [ -s ext_list ]; then
	for Ext in $ext_list
	do
	    if [ "$HOME" != "$Dir" ]; then
		mkdir -p -v "$Dir/$Ext"
		find . -type f -name "*.${Ext}" -exec mv -v -i {} "$Dir/$Ext" ';' 
	    fi
	done


    fi
    rm ext_list
}

foldering_by_type "$saveIn"
cInfo "Foldering by type:"
cOk
#delete empty folders crated
find . -type d -empty -delete # &> /dev/null
cInfo "Cleaning empty folders:"
cOk

