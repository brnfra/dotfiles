#!/usr/bin/env bash
# Arquivo: pull_config
# Autor: Bruno Franco
# Ultima_modificacao: 07-11-2023
# Download: git@github.com:brnfra
# Licence:Este arquivo é de domínio público
# Garantia: O autor não se responsabiliza por eventuais danos
#           causados pelo uso deste script.
printf "Get config from remote repo and update local config files.\n"

if [[ "$1" == "-h" || "$1" == "--help" ]]; then cat <<HELP
${0##*/}

NAME
    ${0##*/}  - Get config from remote repo and update local config files.

SYNOPSIS
    ${0##*/} [-h] --help

DESCRIPTION
    A simple script to get config from remote repo and update local config files. Becareful, if you made some 
    local modifications it'll ovewrite with remote config.

    -h, --help
	Print help informations

Exit status:
       0      if OK,

       1      ssh-agent error.

       2      connection problem error.

       3      connection and ssh-agent problem(error).

       4      pull and fetch fails.


See the README for documentation.
https://github.com/brnfra/dotfiles
Licensed under the MIT license.
HELP
exit; fi


for file in ~/bin/{bare_repo_pull,local_repo_pull,ssh_config,dotfiles_env}; do
    [ -r "$file" ] && [ -f "$file" ] && source "$file";
done;
unset file;
cInfo "Get config from remote:" "pull_config" 
cInfo "Get config from remote:" "pull_config" >> "$bkpLog"

if connection &> /dev/null && ssh_connect &> /dev/null;then
    #try pull 
    if bare_repo_pull;then
	local_repo_pull
    elif bare_repo_fetch; then
	local_repo_fetch
    else
	exit 4
    fi
elif connection &> /dev/null; then
    cmOk "Connection"
    clnError "Check your ssh-agent."
    exit 1
elif ssh_connect &> /dev/null;then
    cmOk "ssh-agent"
    clnError "Check your connection."
    exit 2
else 
    clnError "Check your connection and your ssh-agent."
    exit 3
fi
